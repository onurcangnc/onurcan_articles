<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Admin</title>

    <!-- Manuel başlatacağımız için auto-init kapalı -->
    <script>window.CMS_MANUAL_INIT = true;</script>

    <!-- Netlify Identity (login modal) -->
    <script defer src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <!-- Decap CMS -->
    <script defer src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

    <script defer>
      /* ---------- Netlify Identity akışı ---------- */
      function startCMS() {
        if (window.__cmsStarted) return;
        window.__cmsStarted = true;
        CMS.init();                                 // /admin/config.yml
      }

      netlifyIdentity.on('init', (user) => {
        if (user) startCMS();
        else      netlifyIdentity.open('login');
      });

      netlifyIdentity.on('login', () => {
        startCMS();
        netlifyIdentity.close();
      });

      netlifyIdentity.init();

      /* Yüklü kullanıcı varsa sayfa yüklenince de başlat */
      window.addEventListener('DOMContentLoaded', () => {
        if (netlifyIdentity.currentUser()) startCMS();
      });
    </script>
  </head>
  <body></body>
</html>
