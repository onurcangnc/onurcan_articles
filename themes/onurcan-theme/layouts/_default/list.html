{{ define "main" }}
  <section class="col-md-8">
    {{ $paginator := .Paginate (where .Site.RegularPages "Type" "in" (slice "posts" "post")) }}
    {{ range $paginator.Pages }}
    <article class="blog-item">
      <div class="row">
        <div class="col-md-3">
          <a href="{{ .RelPermalink }}">
            {{ $img := "" }}
            {{ with .Params.image }}{{ $img = . }}{{ end }}
            {{ if not $img }}
              {{ with .Params.thumbnail }}{{ $img = . }}{{ end }}
            {{ end }}
            {{ if not $img }}
              {{ $res := .Resources.GetMatch "featured*" }}
              {{ if $res }}{{ $img = $res.RelPermalink }}{{ end }}
            {{ end }}
            {{ if not $img }}
              {{ $img = "/img/posts/htb-access.jpg" }}
            {{ end }}
            <img src="{{ $img }}" class="img-thumbnail center-block" alt="{{ .Title }}">
          </a>
        </div>
        <div class="col-md-9">
          <p>
            in 
            {{ $tags := .Params.tags }}
            {{ if $tags }}
              {{ range $i, $t := $tags }}
                <a href="{{ (printf "/tags/%s/" (urlize $t)) }}">{{ $t }}</a>{{ if lt (add $i 1) (len $tags) }}, {{ end }}
              {{ end }}
            {{ end }}
            <time>{{ .Date.Format "02-Jan-2006" }}</time>
          </p>
          <h1><a href="{{ .RelPermalink }}">{{ .Title }}</a></h1>

          {{ with .Params.summary }}
            <p class="post-summary">{{ . }}</p>
          {{ else }}
            {{ if .Summary }}<p class="post-summary">{{ .Summary }}</p>{{ end }}
          {{ end }}

        </div>
      </div>
    </article>
    {{ end }}

    <div class="page-turn">
      <div class="row">
        <div class="col-md-6 col-md-offset-3 text-center">
          {{ template "_internal/pagination.html" . }}
        </div>
      </div>
    </div>
  </section>

  {{ partial "sidebar.html" . }}
{{ end }}
