<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <!-- Netlify Identity Widget Script -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 50px; }
    #login-status { margin-bottom: 20px; }
    button { padding: 10px 15px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>

<h1>Admin Panel</h1>
<div id="login-status">Durum: Henüz giriş yapılmadı.</div>
<button id="login-btn">Giriş Yap / Kayıt Ol</button>
<button id="logout-btn" style="display:none;">Çıkış Yap</button>

<script>
  // Widget'ı başlat
  const netlifyIdentity = window.netlifyIdentity;

  netlifyIdentity.init();

  const loginStatus = document.getElementById('login-status');
  const loginBtn = document.getElementById('login-btn');
  const logoutBtn = document.getElementById('logout-btn');

  // URL'de invite_token var mı kontrol et
  if (window.location.hash.includes('invite_token')) {
    netlifyIdentity.open('signup'); // Invite token varsa otomatik signup modal aç
  }

  // Giriş butonu açar
  loginBtn.onclick = () => netlifyIdentity.open();

  // Çıkış yapar
  logoutBtn.onclick = () => netlifyIdentity.logout();

  // Oturum açıldığında
  netlifyIdentity.on('login', user => {
    loginStatus.textContent = `Giriş yapıldı: ${user.email}`;
    loginBtn.style.display = 'none';
    logoutBtn.style.display = 'inline-block';
    netlifyIdentity.close();
    // İstersen CMS paneline yönlendir:
    // window.location.href = "/admin/#/collections/blog";
  });

  // Oturum kapandığında
  netlifyIdentity.on('logout', () => {
    loginStatus.textContent = 'Durum: Henüz giriş yapılmadı.';
    loginBtn.style.display = 'inline-block';
    logoutBtn.style.display = 'none';
  });

  // Sayfa yüklendiğinde mevcut kullanıcı varsa durum göster
  netlifyIdentity.on('init', user => {
    if (user) {
      loginStatus.textContent = `Giriş yapıldı: ${user.email}`;
      loginBtn.style.display = 'none';
      logoutBtn.style.display = 'inline-block';
    }
  });
</script>

</body>
</html>
